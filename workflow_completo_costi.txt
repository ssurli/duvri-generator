â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 INIZIO: Creazione DUVRI                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Dati Committente                                    â”‚
â”‚  - Importo appalto (importo_gara_base)                      â”‚
â”‚  - Costi inclusi in gara? (costi_inclusi_gara)              â”‚
â”‚  - Se SI: importo costi sicurezza gara                      â”‚
â”‚  - Usa costi manuali? (usa_costi_manuali)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: Dati Appaltatore                                    â”‚
â”‚  - Numero lavoratori (max_addetti)                          â”‚
â”‚  - Durata lavori (durata_giorni)                            â”‚
â”‚  - Rischi identificati (rischi)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Calcolo Costi Parametrico                          â”‚
â”‚  Funzione: calcola_costi_sicurezza()                        â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£ COSTO BASE                                               â”‚
â”‚     â€¢ 2% dell'importo appalto                               â”‚
â”‚     â€¢ Costo base = â‚¬50,000 Ã— 0.02 = â‚¬1,000                 â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£ COSTI PER LAVORATORE                                     â”‚
â”‚     â€¢ DPI base: â‚¬150                                        â”‚
â”‚     â€¢ Formazione: â‚¬200                                      â”‚
â”‚     â€¢ Sorveglianza: â‚¬0 (se necessaria)                     â”‚
â”‚     â€¢ Per lavoratore: â‚¬350                                  â”‚
â”‚     â€¢ Totale: 3 Ã— â‚¬350 = â‚¬1,050                            â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£ COSTI RISCHI SPECIFICI                                   â”‚
â”‚     â€¢ Impiantistica: variabile                              â”‚
â”‚     â€¢ Controlli: variabile                                  â”‚
â”‚     â€¢ Segnaletica: variabile                                â”‚
â”‚     â€¢ Nel tuo caso: â‚¬0                                      â”‚
â”‚                                                              â”‚
â”‚  4ï¸âƒ£ COSTI DURATA                                             â”‚
â”‚     â€¢ Incontri: max(1, giorni//5) Ã— â‚¬250                   â”‚
â”‚     â€¢ Controlli: max(1, giorni//10) Ã— â‚¬200                 â”‚
â”‚     â€¢ Con 2 giorni: 1Ã—â‚¬250 + 1Ã—â‚¬200 = â‚¬450                 â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š TOTALE: â‚¬1,000 + â‚¬1,050 + â‚¬0 + â‚¬450 = â‚¬2,500           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: Confronto con Costi Gara                           â”‚
â”‚  Funzione: calcola_e_confronta_costi()                      â”‚
â”‚                                                              â”‚
â”‚  INPUT:                                                      â”‚
â”‚  â€¢ Costi gara: â‚¬0 (non previsti)                           â”‚
â”‚  â€¢ Costi operativi: â‚¬2,500                                  â”‚
â”‚  â€¢ Importo contratto: â‚¬50,000                               â”‚
â”‚                                                              â”‚
â”‚  CALCOLO:                                                    â”‚
â”‚  â€¢ Delta: â‚¬2,500 - â‚¬0 = â‚¬2,500                             â”‚
â”‚  â€¢ % sul contratto: 2,500/50,000 Ã— 100 = 5.0%              â”‚
â”‚  â€¢ Incremento: 100% (costi totalmente nuovi)                â”‚
â”‚                                                              â”‚
â”‚  IDENTIFICAZIONE TIPO:                                       â”‚
â”‚  â€¢ Costi inclusi? SI                                        â”‚
â”‚  â€¢ Costi evidenziati? NO (â‚¬0)                              â”‚
â”‚  â€¢ â†’ SCENARIO 2: Costi inclusi ma compensati                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 5: Verifica Soglie (config_scenario.py)              â”‚
â”‚                                                              â”‚
â”‚  SOGLIE CONFIGURATE:                                         â”‚
â”‚  â€¢ Soglia assoluta: â‚¬1,000                                  â”‚
â”‚  â€¢ Soglia percentuale: 3.0%                                 â”‚
â”‚  â€¢ Operatore: OR (sotto ALMENO UNA)                         â”‚
â”‚                                                              â”‚
â”‚  VERIFICA:                                                   â”‚
â”‚  â€¢ â‚¬2,500 < â‚¬1,000? âŒ NO                                   â”‚
â”‚  â€¢ 5.0% < 3.0%? âŒ NO                                       â”‚
â”‚  â€¢ Operatore OR: FALSE                                      â”‚
â”‚                                                              â”‚
â”‚  RISULTATO: SOPRA ENTRAMBE LE SOGLIE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: Determinazione Scenario Normativo                  â”‚
â”‚                                                              â”‚
â”‚  Soglie superate â†’ ATTO AGGIUNTIVO                          â”‚
â”‚                                                              â”‚
â”‚  VERIFICA LIMITE 50%:                                        â”‚
â”‚  â€¢ 5.0% < 50%? âœ… SI                                        â”‚
â”‚  â€¢ Entro limite legale (art. 120)                          â”‚
â”‚                                                              â”‚
â”‚  SCENARIO FINALE:                                            â”‚
â”‚  â€¢ scenario_normativo: ATTO_AGGIUNTIVO_ART120               â”‚
â”‚  â€¢ supera_limite_50: FALSE                                  â”‚
â”‚  â€¢ Richiede: Atto aggiuntivo formale                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 7: Salvataggio Extra-Costi                           â”‚
â”‚  Funzione: crea_extra_costo() / aggiorna_extra_costo()     â”‚
â”‚                                                              â”‚
â”‚  RECORD DATABASE (extra_costi_sicurezza):                   â”‚
â”‚  â€¢ duvri_id: 604fcb27                                      â”‚
â”‚  â€¢ importo_totale: â‚¬2,500                                   â”‚
â”‚  â€¢ scenario_normativo: ATTO_AGGIUNTIVO_ART120               â”‚
â”‚  â€¢ supera_limite_50: 0 (FALSE)                             â”‚
â”‚  â€¢ note_committente: NULL                                   â”‚
â”‚  â€¢ note_appaltatore: NULL                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 8: Generazione PDF                                    â”‚
â”‚  Funzione: prepara_dati_per_pdf() â†’ render_template()      â”‚
â”‚                                                              â”‚
â”‚  SEZIONE 2.6.3 NEL PDF:                                     â”‚
â”‚                                                              â”‚
â”‚  ğŸ“¦ BOX GIALLO (sempre presente):                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ ART. RIFERIMENTO NORMATIVO             â”‚                â”‚
â”‚  â”‚ â— CASO 1: Atto Aggiuntivo             â”‚                â”‚
â”‚  â”‚ â— CASO 2: Compensazione Interna       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”‚  ğŸ“¦ BOX ROSSO (scenario ATTO_AGGIUNTIVO):                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ [!] ATTO AGGIUNTIVO / PERIZIA VARIANTE â”‚                â”‚
â”‚  â”‚ Art. 120 c.1 lett. b) D.Lgs. 36/2023  â”‚                â”‚
â”‚  â”‚ Importo extra-costo: â‚¬2,500.00        â”‚                â”‚
â”‚  â”‚ Percentuale: 5.0% contratto            â”‚                â”‚
â”‚  â”‚ âœ… Entro limite 50%                    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario A: Compensazione
Committente inserisce:
â”œâ”€ Costi inclusi in gara: SI
â”œâ”€ Costi sicurezza gara: â‚¬0
â””â”€ Importo appalto: â‚¬50,000

Appaltatore compila DUVRI:
â”œâ”€ Lavoratori: 2
â”œâ”€ Durata: 1 giorno
â””â”€ Rischi: minimi

Sistema calcola:
â”œâ”€ Costi operativi: â‚¬800
â”œâ”€ % contratto: 1.6%
â””â”€ Sotto soglia 3% âœ…

Risultato:
â”œâ”€ Scenario: COMPENSAZIONE
â”œâ”€ Box verde nel PDF
â””â”€ Richiesto: Verbale concordamento RUP


Scenario B: Atto Aggiuntivo
Committente inserisce:
â”œâ”€ Costi inclusi in gara: SI
â”œâ”€ Costi sicurezza gara: â‚¬0
â””â”€ Importo appalto: â‚¬50,000

Appaltatore compila DUVRI:
â”œâ”€ Lavoratori: 3
â”œâ”€ Durata: 2 giorni
â””â”€ Rischi: moderati

Sistema calcola:
â”œâ”€ Costi operativi: â‚¬2,500
â”œâ”€ % contratto: 5.0%
â””â”€ Sopra entrambe soglie âŒ

Risultato:
â”œâ”€ Scenario: ATTO_AGGIUNTIVO
â”œâ”€ Box rosso nel PDF
â””â”€ Richiesto: Atto aggiuntivo formale